<Page x:Class="Argus_WPF.Pages.TaskManagerPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="TaskManagerPage"
      Background="#F8F8F8"
      Loaded="Page_Loaded">

    <Page.Resources>

        <!-- 🌈 Стиль заголовков колонок -->
        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#F1F3F5"/>
            <Setter Property="Foreground" Value="#2c3e50"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="4" ShadowDepth="1" Opacity="0.1"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 🎨 Стиль строки в зависимости от статуса -->
        <Style x:Key="StatusRowStyle" TargetType="DataGridRow">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Status}" Value="Не начато">
                    <Setter Property="Background" Value="#f2f2f2"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Выполняется">
                    <Setter Property="Background" Value="#fff5cc"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Завершено">
                    <Setter Property="Background" Value="#d6ffd6"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 🔷 Заголовок -->
        <Border Grid.Row="0" Padding="20,10" Background="#4A86FC">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="🗒" FontSize="28" Margin="0,0,10,0"/>
                <TextBlock Text="Управление задачами"
                           FontSize="24"
                           FontWeight="Bold"
                           Foreground="White"/>
            </StackPanel>
        </Border>

        <!-- 🔽 Контент -->
        <Grid Grid.Row="1" Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- 🔍 Фильтры -->
            <Border Grid.Row="0" CornerRadius="8" Background="White" Padding="10" Margin="0 0 0 10">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <StackPanel Margin="0,0,20,0">
                        <TextBlock Text="Поиск по исполнителю:" FontWeight="Bold"/>
                        <TextBox x:Name="txtSearchExecutor" Width="200" Margin="0,5,0,0"/>
                    </StackPanel>
                    <StackPanel Margin="0,0,20,0">
                        <TextBlock Text="Статус:" FontWeight="Bold"/>
                        <ComboBox x:Name="cmbFilterStatus" Width="150" Margin="0,5,0,0">
                            <ComboBoxItem Content="Все" IsSelected="True"/>
                            <ComboBoxItem Content="Не начато"/>
                            <ComboBoxItem Content="Выполняется"/>
                            <ComboBoxItem Content="Завершено"/>
                        </ComboBox>
                    </StackPanel>
                    <Button x:Name="BtnApplyFilter"
                            Content="Применить"
                            Margin="20,0,0,0"
                            Click="BtnApplyFilter_Click"
                            Background="#7cbd2e"
                            Foreground="White"
                            Padding="10 6"
                            FontWeight="SemiBold"
                            BorderThickness="0"
                            Cursor="Hand"/>
                </StackPanel>
            </Border>

            <!-- 📋 Таблица -->
            <Border Grid.Row="1" CornerRadius="8" Background="White" Padding="10">
                <DataGrid x:Name="TaskGrid"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          IsReadOnly="True"
                          RowStyle="{StaticResource StatusRowStyle}"
                          RowHeight="36"
                          ColumnHeaderHeight="40"
                          AlternatingRowBackground="#f9f9f9"
                          GridLinesVisibility="None">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Исполнитель" Binding="{Binding Executor}" Width="*"/>
                        <DataGridTextColumn Header="Описание" Binding="{Binding Description}" Width="2*"/>
                        <DataGridTextColumn Header="Статус" Binding="{Binding Status}" Width="*"/>
                        <DataGridTextColumn Header="Создано" Binding="{Binding CreatedAt, StringFormat={}{0:dd.MM.yy HH:mm}}" Width="1.5*"/>
                        <DataGridTextColumn Header="Обновлено" Binding="{Binding LastUpdated, StringFormat={}{0:dd.MM.yy HH:mm}}" Width="1.5*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Border>

            <!-- ➕ Кнопки + счетчик -->
            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0 10 0 0">
                <TextBlock x:Name="TasksCountLabel"
                           Text="Всего задач: 0"
                           VerticalAlignment="Center"
                           FontWeight="Bold"
                           Margin="0 20 20 0"
                           Foreground="#2c3e50"/>
                <Button x:Name="AddTaskButton" Content="Добавить" Click="AddTaskButton_Click" Background="#4A86FC" Foreground="White" Padding="10 6" Margin="5" BorderThickness="0"/>
                <Button x:Name="EditTaskButton" Content="Изменить" Click="EditTaskButton_Click" Background="#FFB127" Foreground="White" Padding="10 6" Margin="5" BorderThickness="0"/>
                <Button x:Name="DeleteTaskButton" Content="Удалить" Click="DeleteTaskButton_Click" Background="#E74C3C" Foreground="White" Padding="10 6" Margin="5" BorderThickness="0"/>
            </StackPanel>

        </Grid>
    </Grid>
</Page>
